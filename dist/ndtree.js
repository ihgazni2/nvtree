!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.NDTREEJS=e():t.NDTREEJS=e()}(this,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e){function n(t){return Object.entries(t).length}function n(t){return Object.entries(t).length}t.exports={gen_guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},range:function(t,e){return Array.from({length:e-t}).map((e,n)=>n+t)},seqs_slct:function(t,e){return e.filter((e,n)=>t.includes(n))},dict_length:n,is_empty_dict:function(t){return 0===Object.entries(t).length},dict_values:function(t){return Object.entries(t).map(t=>t[1])},dict_keys:function(t){return Object.entries(t).map(t=>t[0])},dict_map:function(t,e){for(let n in t)t[n]=e(n,t[n]);return t},dict_foreach:function(t,e){for(let n in t)e(n,t[n]);return t},dict_length:n,dict_plus:function(t,e){for(let n in e)t[n]=e[n];return t},dict_update:function(t,e){for(let n in e){!(n in t)&&(t[n]=e[n])}return t},dtb_kv_rm:function(t,e,n){return n=n.filter(n=>n[t]!==e)},dtb_kv_get_seq:function(t,e,n){return n.findIndex(n=>n[t]===e)},dcp:function(t){return JSON.parse(JSON.stringify(t))},mat_map:function(t,e){for(let n=0;n<t.length;n++){lyr=t[n];for(let r=0;r<lyr.length;r++)t[n][r]=e(t[n][r],n,r)}return t},is_cu_property:function(t){let e="_"!==t[0],n="$"!==t[0];return e&&n}}},function(t,e,n){const r=n(0);function i(t){if(r.is_empty_dict(t))return 0;{let e=r.dict_keys(t);return Math.max(...e)+1}}function l(t){return null!=t}function s(t,e){return t._id=t._id+e,t._tree=t._tree+e,l(t._fstch)&&(t._fstch=t._fstch+e),l(t._lsib)&&(t._lsib=t._lsib+e),l(t._rsib)&&(t._rsib=t._rsib+e),l(t._parent)&&(t._parent=t._parent+e),t}function u(t,e){let n=i(t);for(let t in e){let r=s(e[t],n);e[r._id]=r,delete e[t]}return e}function o(t){return void 0!==t._tree}function _(t){let e=void 0!==t._tree,n=t._tree===t._id;return e&&n}function f(t){return null===t._lsib}function c(t){return null===t._rsib}function d(t){return null===t._fstch}function h(t,e){if(_(t))return!0;return 1===E(F(t,e),e).length}function a(t){return _(t)||!o(t)}function p(t,e,n){if(!a(e))return console.log("only root or uninited could be prepend"),t;let r=d(t);if(e._tree=t._tree,e._lsib=null,r)e._rsib=null,e._parent=t._id;else{let r=n[t._fstch];r._lsib=void 0,e._rsib=r._id,e._parent=void 0}return t._fstch=e._id,n[e._id]=e,t}function $(t,e,n){if(!a(e))return console.log("only root or uninited could be append"),t;let r=d(t);if(e._tree=t._tree,e._rsib=null,r)t._fstch=e._id,e._lsib=null;else{let r=S(t,n);r._parent=void 0,r._rsib=e._id,e._lsib=void 0}return e._parent=t._id,n[e._id]=e,t}function g(t,e,n){if(!a(e))return console.log("only root or uninited could be add"),t;if(_(t))return console.log("cant addrsib to root"),t;let r=c(t);return e._tree=t._tree,r?(e._parent=t._parent,t._parent=void 0,e._rsib=null):(e._rsib=t._rsib,e._parent=void 0),t._rsib=e._id,e._lsib=void 0,n[e._id]=e,t}function b(t,e,n){if(!a(e))return console.log("only root or uninited could be add"),t;if(_(t))return console.log("cant addlsib to root"),t;let r=f(t);if(e._tree=t._tree,r){let r=F(t,n);t._lsib=void 0,e._lsib=null,r._fstch=e._id}else{J(t,n)._rsib=e._id,e._lsib=void 0}return e._rsib=t._id,e._parent=void 0,n[e._id]=e,t}function m(t,e,n,r){let i=E(e,r),l=i.length;if(0===l)return p(e,n,r);if(t<=l&&t>=0){if(0===t)return p(e,n,r);if(t===l)return $(e,n,r);return g(i[t-1],n,r)}return console.log("not in range!!"),e}function v(t,e){for(let n in e)e[n]._tree=t._tree}function x(t,e){let n=H(t,e),r=n[0]._id;return n.forEach(t=>{t._tree=r}),n}function y(t,e){let n={};return t.map(t=>{let r=t._id;n[r]=t,delete e[r]}),n}function w(t){return t._fstch=null,t}function j(t){return t._lsib=null,t._rsib=null,t._parent=null,t}function O(t,e){if(_(t))return[t,e];if(h(t,e)){w(e[t._parent]);let n=y(x(t,e),e);return j(t),[t,n]}if(f(t)){P(t,e)._lsib=null,F(t,e)._fstch=t._rsib;let n=y(x(t,e),e);return j(t),[t,n]}if(c(t)){let n=J(t,e);n._rsib=t._rsib,n._parent=t._parent;let r=y(x(t,e),e);return j(t),[t,r]}{J(t,e)._rsib=t._rsib;let n=y(x(t,e),e);return j(t),[t,n]}}function k(t,e){return null===t._fstch?null:e[t._fstch]}function E(t,e){let n=[],r=k(t,e);for(;null!==r;)n.push(r),r=P(r,e);return n}function S(t,e){let n=E(t,e);return 0===n.length?null:n[n.length-1]}function q(t,e,n){let r=E(e,n);if(0===r.length)return null;return t>r.length-1||t<0?null:r[t]}function M(t,e,...n){let r=E(t,e),i=[];if(0===r.length);else for(let t=0;t<n.length;t++){let e=n[t];e>r.length-1||e<0||i.push(r[e])}return i}function T(t,e,n=!1){let r=t,i=P(t,e);for(;null!==i;)r=i,i=P(i,e);return n||r._id!==t._id?r:null}function N(t,e,n=!1){let i,l=F(t,e);return i=null!==l?E(l,e):[t],n||(i=r.dtb_kv_rm("_id",t._id,i)),i}function J(t,e){let n=N(t,e,!0),i=r.dtb_kv_get_seq("_id",t._id,n);return 0===i?null:n[i-1]}function P(t,e){return null===t._rsib?null:e[t._rsib]}function A(t,e){return L(t,e,!0).length-1}function I(t,e){let n=A(t,e),r=H(t,e).map(t=>A(t,e));return Math.max(...r)-n+1}function R(t,e){let n=H(D(t,e),e),r=A(t,e);return n.filter(t=>A(t,e)===r)}function z(t,e){let n=R(t,e);return r.dtb_kv_get_seq("_id",t._id,n)}function D(t,e){let n=t,r=F(t,e);for(;null!==r;)n=r,r=F(r,e);return n}function F(t,e){let n;if(_(t))n=null;else{n=e[T(t,e,!0)._parent]}return n}function L(t,e,n=!1){let r=[],i=F(t,e);for(;null!==i;)r.push(i),i=F(i,e);return n&&r.unshift(t),r}function B(t,e){let n=F(t,e);for(;null!==n;){let t=P(n,e);if(null!==t)return t;n=F(n,e)}return null}function C(t,e){let n=k(t,e);if(null!==n)return n;{let n=P(t,e);return null!==n?n:B(t,e)}}function G(t,e){let n=t,r=S(t,e);for(;null!==r;)n=r,r=S(r,e);return n}function H(t,e){let n=A(t,e),r=[];for(;null!==t;)if(r.push(t),null!==(t=C(t,e))){if(A(t,e)<=n)break}return r}function K(t,e){let n=t,r=k(t,e);for(;null!==r;)n=r,r=k(r,e);return n}function Q(t,e){let n=P(t,e);if(null===n){return F(t,e)}return K(n,e)}function U(t,e){let n=F(t,e);for(;null!==n;){let t=J(n,e);if(null!==t)return t;n=F(n,e)}return null}function V(t,e){let n=[],r=K(t,e);for(;null!==r&&(n.push(r),r._id!==t._id);)r=Q(r,e);return n}function W(t){r.dict_foreach(t,(e,n)=>{t[e]._$visited=!1})}function X(t,e){let n=t._$visited;if(d(t)){if(n){let n=P(t,e);return null===n?F(t,e):n}return t._$visited=!0,t}if(n){let n=P(t,e);return null===n?F(t,e):n}return t._$visited=!0,k(t,e)}function Y(t,e){return e._$visited&&t===e._id}function Z(t,e,n=!1,i=!0){let l=[];W(e);let s=t._id;for(;!Y(s,t);)n?l.push(r.dcp(t)):l.push(t),t=X(t,e);return n?l.push(r.dcp(t)):l.push(t),i&&W(e),l}function tt(t){let e={ele:{}};return e.nd=t,e.ele._id=t._id,e.ele._children=[],e}function et(t,e){let n=[],r=[tt(t[0])];for(r[0].ele._pbreadth=null;r.length>0;){let t=[];for(let i=0;i<r.length;i++){r[i].ele._breadth=i,r[i].ele._depth=n.length;let l=E(r[i].nd,e);l=l.map(t=>tt(t)),l.forEach((e,l)=>{e.ele._pbreadth=r[i].ele._breadth,r[i].ele._children.push([n.length+1,t.length+l])}),t=t.concat(l)}let i=r.map(t=>t.ele);n.push(i),r=t}return n}function nt(t,e){return V(t[0],e)}function rt(t,e,n=!1,r=!0){return Z(t[0],e,n,r)}function it(t,e){return H(t[t.length-1],e)}function lt(t,e){return H(t[0],e)}function st(t,e,n=!1){let r=H(t,e);return n||r.splice(0,1),r}function ut(t,e,n){let r=A(e,n),i=st(e,n,!1);sdfs.map(t=>A(t,n));return i=i.filter(e=>A(e,n)===r+t),i}function ot(t){return D(t[r.dict_keys(t)[0]],t)}t.exports={calc_next_id:i,update_nodes_ids:u,creat_root:function(t=0){return{_id:t,_fstch:null,_lsib:null,_rsib:null,_parent:null,_tree:t}},creat_nd:function(t,e=0){return{_id:i(t)+e,_fstch:null,_lsib:void 0,_rsib:void 0,_parent:void 0,_tree:void 0}},is_inited:o,is_root:_,is_fstch:f,is_lstch:c,is_leaf:d,is_lonely:h,is_id:l,is_connectable:a,prepend_child:p,append_child:$,insert_child:m,add_rsib:g,add_lsib:b,get_fstch:k,get_rsib:P,get_children:E,get_lstch:S,get_which_child:q,get_some_children:M,get_fstsib:function(t,e,n=!1){let r=N(t,e,!0);return n?r[0]:r[0]._id===t._id?null:r[0]},get_lstsib:T,get_preceding_sibs:function(t,e){let n=N(t,e,!0),i=r.dtb_kv_get_seq("_id",t._id,n),l=[];if(0===n.length);else for(let t=0;t<n.length;t++){t<i&&l.push(n[t])}return l},get_following_sibs:function(t,e){let n=N(t,e,!0),i=r.dtb_kv_get_seq("_id",t._id,n),l=[];if(0===n.length);else for(let t=0;t<n.length;t++){t>i&&l.push(n[t])}return l},get_sibs:N,get_which_sib:function(t,e,n){let r=N(e,n,!0);return t<=r.length-1&&t>=0?r[t]:null},get_some_sibs:function(t,e,...n){let r=N(t,e,!0),i=[];if(0===r.length);else for(let t=0;t<n.length;t++){let e=n[t];e>r.length-1||e<0||i.push(r[e])}return i},get_sibseq:function(t,e){let n=N(t,e,!0);return r.dtb_kv_get_seq("_id",t._id,n)},get_lsib:J,get_rsib:P,get_lyr:R,get_breadth:z,get_count:function(t,e){return H(t,e).length},get_depth:A,get_height:I,get_fst_lyr_des_depth:function(t,e){return d(t)?null:A(t,e)+1},get_lst_lyr_des_depth:function(t,e){if(d(t))return null;{A(t,e);let n=H(t,e).map(t=>A(t,e));return Math.max(...n)}},get_which_lyr_des_depth:function(t,e,n){let r=A(e,n);return I(e,n)<=t?null:r+t},get_root:D,get_parent:F,get_ances:L,get_which_ance:function(t,e,n){let r=L(e,n,!0);return t<r.length&&t>=0?r[t]:null},get_some_ances:function(t,e,...n){let r=L(t,e,!0),i=[];if(0===r.length);else for(let t=0;t<n.length;t++){let e=n[t];e>r.length-1||e<0||i.push(r[e])}return i},get_rsib_of_fst_ance_having_rsib:B,get_sdfs_next:C,get_drmost_des:G,get_sdfs_prev:function(t,e){if(_(t))return null;if(d(t)){let n=J(t,e);if(null!==n)return n;return F(t,e)}{let n=J(t,e);if(null!==n){return d(n)?n:G(n,e)}return F(t,e)}},get_sdfs:H,get_lsib_of_fst_ance_having_lsib:U,get_dlmost_des:K,get_edfs_next:Q,get_edfs_prev:function(t,e){if(d(t)){let n=J(t,e);return null===n?U(t,e):n}return S(t,e)},get_edfs:V,clear_$visited:W,get_sedfs_next:X,is_sedfs_traverse_finished:Y,get_sedfs_prev:function(t,e,n){if(d(e)){if(t)return e;{let t=J(e,n);return null===t?F(e,n):t}}if(t)return S(e,n);{let t=J(e,n);return null===t?F(e,n):t}},get_sedfs:Z,get_deses:st,get_fst_lyr_deses:function(t,e){return E(t,e)},get_lst_lyr_deses:function(t,e){let n=st(t,e,!1),r=sdfs.map(t=>A(t,e)),i=Math.max(...r);return n=n.filter(t=>A(t,e)===i),n},get_which_lyr_deses:ut,get_some_lyrs_deses:function(t,e,...n){let r=n.map(n=>ut(n,t,e));return r=Array.prototype.concat(...r),r},nd2ele:function(t,e){let n={};n._depth=A(t,e),n._breadth=z(t,e);let r=F(t,e);return n._pbreadth=null===r?null:z(r,e),n._id=t._id,n},sdfs2mat:et,sdfs2edfs:nt,sdfs2sedfs:rt,edfs2mat:function(t,e){return et(it(t,e),e)},edfs2sdfs:it,edfs2sedfs:function(t,e,n=!1,r=!0){return rt(it(t,e),e,n,r)},sedfs2mat:function(t,e){return et(lt(t,e),e)},sedfs2sdfs:lt,sedfs2edfs:function(t,e){return nt(lt(t,e),e)},update_disconnected_nodes:x,update_orig_nodes:y,leafize:w,rootize:j,disconnect:O,rm_fstch:function(t,e){let n=k(t,e);return null===n?[t,e]:O(n,e)},rm_lstch:function(t,e){let n=S(t,e);return null===n?[t,e]:O(n,e)},rm_which:function(t,e,n){let r=q(t,e,n);return null===r?[e,n]:O(r,n)},rm_some:function(t,e,...n){let r=M(t,e,...whiches);for(let t=0;t<r.length;t++)O(r[t],e);return[t,e]},rm_all:function(t,e){let n=E(t,e);for(let t=0;t<n.length;t++)O(n[t],e);return e},update_treeid:v,update_one_nodeid:s,update_nodes_ids:u,prepend_child_tree:function(t,e,n){return v(t=p(t,D((n=u(e,n))[r.dict_keys(n)[0]],n),e),n),r.dict_plus(e,n),t},append_child_tree:function(t,e,n){return v(t=$(t,D((n=u(e,n))[r.dict_keys(n)[0]],n),e),n),r.dict_plus(e,n),t},add_rsib_tree:function(t,e,n){return v(t=g(t,D((n=u(e,n))[r.dict_keys(n)[0]],n),e),n),r.dict_plus(e,n),t},add_lsib_tree:function(t,e,n){return v(t=b(t,D((n=u(e,n))[r.dict_keys(n)[0]],n),e),n),r.dict_plus(e,n),t},insert_child_tree:function(t,e,n,i){return v(e=m(t,e,D((i=u(n,i))[r.dict_keys(i)[0]],i),n),i),r.dict_plus(n,i),e},get_root_via_tree:ot,tree2sdfs:function(t){return H(ot(t),t)}}},function(t,e,n){t.exports={rjson:function(t){if(void 0===globalThis.document){let e=n(3).readFileSync(t).toString();return JSON.parse(e)}},wjson:function(t,e){if(globalThis.document){let r=n(3),i=JSON.stringify(e);r.writeFileSync(t,i)}},is_int_str:function(t){return parseInt(t).toString()===t}}},function(t,e){},function(t,e,n){const r=n(5),i=n(1),l=n(7),s=n(2);t.exports={ndfunc:i,ndfuncterm:l,ndcls:r,ndutil:s}},function(t,e,n){const r=n(2),i=n(0),l=n(1),s=n(6).EventTarget,u=["_fstch","_lsib","_rsib","_parent","_tree"];function o(t){return void 0!==t._tree}function _(t){return t._tree===t}function f(t){return _(t)||!o(t)}function c(t){let e=t._fstch,n=e;for(;null!==e;)n=e,e=e._rsib;return n}function d(t,e){let n=0,r=e._fstch;for(;;){if(n===t)return r;if(null===r)return r;r=r._rsib,n+=1}}function h(t,...e){let n=[],r=0,i=t._fstch;for(;;){if(e.includes(r))n.push(i);else if(null===i)return n;i=i._rsib,r+=1}}function a(t){let e=[],n=0,r=t._fstch;for(;;){if(null===r)return e;e.push(r),r=r._rsib,n+=1}}function p(t,e=!1){let n=t._rsib,r=t;for(;null!==n;)r=n,n=n._rsib;return e||r!==t?r:null}function $(t,e=!1){let n=x(t);if(null===n)return e?t:null;{let r=n._fstch;return e||r!==t?r:null}}function g(t){let e=[],n=$(t,!0);for(;null!==n;){if(n===t)return e;e.push(n),n=n._rsib}}function b(t){let e=[],n=t._rsib;for(;null!==n;)e.push(n),n=n._rsib;return e}function m(t,e=!1){let n=g(t),r=b(t),i=[t];return sibs=e?n.concat(i,r):n.concat(r),sibs}function v(t){return g(t).length}function x(t){return p(t,!0)._parent}function y(t,e=!1){let n=[],r=t;for(e&&n.push(r),r=r.$parent();null!==r;)n.push(r),r=r.$parent();return n}function w(t,e=!1){let n=S(t),r=q(t),i=r.indexOf(n);return e?r.slice(0,i+1):r.slice(1,i+1)}function j(t,e){if(!f(e))return console.log("only root or uninited could be prepend"),e;let n=t.$is_leaf();if(e._tree=t._tree,e._lsib=null,n)e._rsib=null,e._parent=t;else{let n=t._fstch;n._lsib=void 0,e._rsib=n,e._parent=void 0}return t._fstch=e,e}function O(t,e){if(!f(e))return console.log("only root or uninited could be append"),e;let n=t.$is_leaf();if(e._tree=t._tree,e._rsib=null,n)t._fstch=e,e._lsib=null;else{let n=t.$lstch();n._parent=void 0,n._rsib=e,e._lsib=void 0}return e._parent=t,e}function k(t,e){if(!f(e))return console.log("only root or uninited could be add"),e;if(t.$is_root())return console.log("cant addrsib to root"),t;let n=t.$is_lstch();return e._tree=t._tree,n?(e._parent=t._parent,t._parent=void 0,e._rsib=null):(e._rsib=t._rsib,e._parent=void 0),t._rsib=e,e._lsib=void 0,e}function E(t,e,n){let r=a(e),i=r.length;if(0===i)n=j(e,n);else{if(t<=i&&t>=0)if(0===t)n=j(e,n);else if(t===i)n=O(e,n);else{n=k(r[t-1],n)}else console.log("not in range!!")}return n}function S(t){let e=t,n=t.$lstch();for(;null!==n;)e=n,n=n.$lstch();return e}function q(t){let e=t.$depth();if(null===t)return[];{let n=[t];for(t=t.$sdfs_next();null!==t&&t.$depth()>e;)n.push(t),t=t.$sdfs_next();return n}}function M(t){let e=t.$visited;if(t.$is_leaf()){if(e){let e=t.$rsib();return null===e?t.$parent():e}return t.$visited=!0,t}if(e){let e=t.$rsib();return null===e?t.$parent():e}return t.$visited=!0,t.$fstch()}function T(t,e){return e.$visited&&t===e}function N(t){!function(t){t.$sdfs().forEach(t=>{delete t.$visited})}(t);let e=[],n=new Set,r=t;for(;!T(r,t);)n.has(t)?t.$close_at=e.length:(t.$open_at=e.length,n.add(t)),e.push(t),t=M(t);return r.$close_at=e.length,e.push(r),e.forEach(t=>{delete t.$visited}),e}function J(t){return t._lsib=null,t._rsib=null,t._parent=null,t}function P(t){let e=t.$sdfs();return e.forEach(t=>{t._tree=e[0]}),e}function A(t){if(t.$is_root())return t;if(t.$is_lonely()){!function(t){t._fstch=null}(t.$parent());P(t);return J(t),t}if(t.$is_fstch()){t.$rsib()._lsib=null,t.$parent()._fstch=t._rsib;P(t);return J(t),t}if(t.$is_lstch()){let e=t.$lsib();e._rsib=t._rsib,e._parent=t._parent;P(t);return J(t),t}t.$lsib()._rsib=t._rsib;P(t);return J(t),t}function I(t){let e={};return e._nd=t,e._children=[],e}function R(t){let e=[],n=[I(t[0])];for(n[0]._pbreadth=null;n.length>0;){let t=[];for(let r=0;r<n.length;r++){n[r]._breadth=r,n[r]._depth=e.length;let i=n[r]._nd.$children();i=i.map(t=>I(t)),i.forEach((i,l)=>{i._pbreadth=n[r]._breadth,n[r]._children.push([e.length+1,t.length+l])}),t=t.concat(i)}let r=n;e.push(r),n=t}return e}function z(t,e="_children"){let n=t._nd,r={};r[e]=[],r.$guid=n.$guid;for(let t in n){i.is_cu_property(t)&&(r[t]=n[t])}return r}function D(t,e="_children"){let n=new U;void 0!==t.$guid&&(n.$guid=t.$guid);for(let r in t){i.is_cu_property(r)&&e!==r&&(n[r]=t[r])}return n}class F extends s{constructor(){super(),this._fstch=null,this._lsib=void 0,this._rsib=void 0,this._parent=void 0,this._tree=void 0,this.$guid=i.gen_guid()}$is_inited(){return o(this)}$is_root(){return _(this)}$is_fstch(){return null===this._lsib}$is_lstch(){return null===this._rsib}$is_leaf(){return null===this._fstch}$is_lonely(){return 1===this.$sibs(!0).length}$fstch(){return this._fstch}$lstch(){return c(this)}$which_child(t){return d(t,this)}$some_children(...t){return h(this,...t)}$children(){return a(this)}$children_count(){return function(t){let e=0,n=t._fstch;for(;;){if(null===n)return e;n=n._rsib,e+=1}}(this)}$rsib(){return this._rsib}$lsib(){return function(t){let e=$(t,!1);if(null===e)return null;{let n=e;for(;;){if(n._rsib===t)return n;n=n._rsib}}}(this)}$fstsib(t=!1){return $(this,t)}$lstsib(t=!1){return p(this,t)}$psibs(){return g(this)}$fsibs(){return b(this)}$which_sib(t){return function(t,e){let n=$(e,!0),r=0;for(;;){if(null===n)return null;if(r==t)return n;n=n._rsib,r+=1}}(t,this)}$some_sibs(...t){return function(t,...e){return m(t,!0).filter((t,n)=>e.includes(n))}(this,...t)}$sibseq(){return v(this)}$sibs(t=!1){return m(this,t)}$sibs_count(t=!1){return function(t,e=!1){return t.$sibs(e).length}(this,t)}$parent(){return x(this)}$root(){return function(t){let e=t,n=t;for(;null!==e;)n=e,e=e.$parent();return n}(this)}$ances(t=!1){return y(this,t)}$which_ance(t){return function(t,e){let n=0,r=e;for(;null!==r;){if(n===t)return r;r=r.$parent(),n+=1}return null}(t,this)}$some_ances(...t){return function(t,...e){return y(t,!0).filter((t,n)=>e.includes(n))}(this,...t)}$ances_count(t=!1){return function(t,e=!1){return y(t,e).length}(this,t)}$prepend_child(t){return j(this,t=void 0===t?new F:t)}$insert_child(t,e){return E(t,this,e=void 0===e?new F:e)}$append_child(t){return O(this,t=void 0===t?new F:t)}$clone(){if(_(this)){return G(Q(this))}{let t=v(this),e=x(this);A(this);let n=G(Q(this));return E(t,e,this),n}}$append_children(t,e){let n=[];for(let r=0;r<t;r++){let t=void 0===e?new F:e.$clone();t=O(this,t),n.push(t)}return n}$add_rsib(t){return k(this,t=void 0===t?new F:t)}$add_lsib(t){return function(t,e){if(!f(e))return console.log("only root or uninited could be add"),e;if(t.$is_root())return console.log("cant addlsib to root"),t;let n=t.$is_fstch();if(e._tree=t._tree,n){let n=t.$parent();t._lsib=void 0,e._lsib=null,n._fstch=e}else{t.$lsib()._rsib=e,e._lsib=void 0}return e._rsib=t,e._parent=void 0,e}(this,t=void 0===t?new F:t)}$rsib_of_fst_ance_having_rsib(){return function(t){let e=t.$parent();for(;null!==e;){let t=e.$rsib();if(null!==t)return t;e=e.$parent()}return null}(this)}$sdfs_next(){return function(t){let e=t.$fstch();if(null!==e)return e;{let e=t.$rsib();return null!==e?e:t.$rsib_of_fst_ance_having_rsib()}}(this)}$drmost_des(){return S(this)}$sdfs_prev(){return function(t){if(t.$is_root())return null;if(t.$is_leaf()){let e=t.$lsib();if(null!==e)return e;return t.$parent()}{let e=t.$lsib();if(null!==e){return e.$is_leaf()?e:e.$drmost_des()}return t.$parent()}}(this)}$sdfs(){return q(this)}$dlmost_des(){return function(t){let e=t,n=t.$fstch();for(;null!==n;)e=n,n=n.$fstch();return e}(this)}$edfs_next(){return function(t){let e=t.$rsib();if(null===e){return t.$parent()}return e.$dlmost_des()}(this)}$lsib_of_fst_ance_having_lsib(){return function(t){let e=t.$parent();for(;null!==e;){let t=e.$lsib();if(null!==t)return t;e=e.$parent()}return null}(this)}$edfs_prev(){return function(t){if(t.$is_leaf()){let e=t.$lsib();return null===e?t.$lsib_of_fst_ance_having_lsib():e}return t.$lstch()}(this)}$edfs(){return function(t){let e=[],n=t.$dlmost_des();for(;null!==n&&(e.push(n),n!==t);)n=n.$edfs_next();return e}(this)}$offset(){return function(t){let e,n=t.$root().$edfs();if(t.$is_leaf())e=n.indexOf(t);else{let r=t.$dlmost_des();e=n.indexOf(r)}return n=n.slice(0,e+1),offset=n.filter(t=>t.$is_leaf()).length-1,offset}(this)}$sedfs_next(){return M(this)}$sedfs_prev(t){return function(t,e){if(e.$is_leaf()){if(t)return e;{let t=e.$lsib();return null===t?e.$parent():t}}if(t)return e.$lstch();{let t=e.$lsib();return null===t?e.$parent():t}}(this)}$sedfs(){return N(this)}$deses(t=!1){return w(this,t)}$lst_lyr_deses(){return function(t){let e=t.$deses(!1),n=e.map(t=>t.$depth()),r=Math.max(...n);return e=e.filter(t=>t.$depth()===r),e}(this)}$which_lyr_deses(t){return function(t,e){let n=e.$depth(),r=e.$deses(!1);return r.map(t=>t.$depth()),r=r.filter(e=>e.$depth()===n+t),r}(t,this)}$some_lyrs_deses(...t){return function(t,...e){let n=t.$depth(),r=e.map(t=>t+n),i=t.$deses(!1);return i.map(t=>t.$depth()),i=i.filter(t=>r.includes(t.$depth())),i}(this,...t)}$count(t=!0){return w(this,t).length}$depth(t=!1){return y(this,t).length}$height(){let t=this.$depth(),e=this.$sdfs().map(t=>t.$depth());return Math.max(...e)-t+1}$breadth(){return(t=this).$lyr().indexOf(t);var t}$width(){return function(t){let e=t.$sdfs();return e=e.filter(t=>t.$is_leaf()),e.length}(this)}$lyr(){return function(t){let e=t.$root().$sdfs(),n=t.$depth();return e.filter(t=>t.$depth()===n)}(this)}$lcin(){return function(t){let e=t.$luncle();return t.$is_fstch()?null===e?null:e.$lstch():null}(this)}$rcin(){return function(t){let e=t.$runcle();return t.$is_lstch()?null===e?null:e.$fstch():null}(this)}$luncle(){return function(t){let e=t.$parent();return null===e?null:e.$lsib()}(this)}$runcle(){return function(t){let e=t.$parent();return null===e?null:e.$rsib()}(this)}$sdfs_repr(){let t=q(this.$root()),e=q(this);e.map(t=>t.$depth()).map(t=>"    ".repeat(t)).forEach((n,r)=>{console.log(n+"["+t.indexOf(e[r])+"] : "+e[r].$guid)})}$sedfs_repr(){L(this.$root()),N(this).forEach((t,e)=>{let n=t.$depth(),r="    ".repeat(n);e===t.$open_at&&console.log(r+"<"+t._id+" : "+t.$guid+">"),e===t.$close_at&&console.log(r+"</"+t._id+" : "+t.$guid+">")})}$disconn(){return A(this)}$rm_fstch(){return A(this._fstch)}$rm_lstch(){return A(c(this))}$rm_which(t){return A(d(t,this))}$rm_some_children(...t){return h(this,...t).map(t=>A(t))}$rm_all_children(){return a(this).map(t=>A(t))}$dump(){if(this.$is_root())return Q(this);console.log("only root !!!")}$dump2file(t){if(this.$is_root()){let e=Q(this);r.wjson(t,e)}else console.log("only root !!!")}$sdfs2mat(){return R(q(this))}$nest_dict(t="_children"){return function(t,e="_children"){let n=t[0][0],r=z(n,e),i=[{d:r,ele:n}];for(;i.length>0;){let n=[];for(let r=0;r<i.length;r++){let l=i[r],s=l.d,u=(l.ele,l.ele._children.map(e=>t[e[0]][e[1]]));for(let t=0;t<u.length;t++){let r=u[t],i=z(r,e);s[e].push(i);let l={d:i,ele:r};n.push(l)}}i=n}return r}(R(q(this)),t)}}function L(t){let e=q(t);return e.forEach((t,e)=>{t._id=e}),e}function B(t,e){for(;e._id!==t;)e=e._parent;return e}function C(t,e){let n=K(e);for(let r of n)t[r]=e[r];return t}function G(t){let e=i.dict_keys(t)[0],n=l.get_root(t[e],t),r=function(t){let e=new U;return e._id=t._id,e.$guid=t._guid,e}(n);r=C(r,n);let s,u=r,o=n,_=l.get_sdfs_next(o,t);for(;null!==_;)if(o._fstch===_._id)s=u.$prepend_child(),s._id=_._id,s.$guid=_._guid,s=C(s,_),u=s,o=_,_=l.get_sdfs_next(o,t);else if(o._rsib===_._id)s=u.$add_rsib(),s._id=_._id,s.$guid=_._guid,s=C(s,_),u=s,o=_,_=l.get_sdfs_next(o,t);else if(null!==_._parent&&void 0!==_._parent){u=B(_._parent,u),s=u.$append_child(),s._id=_._id,s.$guid=_._guid,s=C(s,_),u=s,o=_,_=l.get_sdfs_next(o,t)}else if(void 0===_._parent){u=B(l.get_parent(_,t)._id,u),s=u.$append_child(),s._id=_._id,s.$guid=_._guid,s=C(s,_),u=s,o=_,_=l.get_sdfs_next(o,t)}else console.log("Impossible",u,o,_);return r}function H(t,e){return null===t[e]?null:void 0===t[e]?void 0:t[e]._id}function K(t){return i.dict_keys(t).filter(t=>!u.includes(t))}function Q(t){let e=L(t),n=t._id,r={};return e.forEach((t,e)=>{let i={};i._tree=n,i._fstch=H(t,"_fstch"),i._lsib=H(t,"_lsib"),i._rsib=H(t,"_rsib"),i._parent=H(t,"_parent"),i._id=t._id,i._guid=t.$guid,i=function(t,e){let n=K(t);for(let r of n)e[r]=t[r];return e}(t,i),r[t._id]=i}),r}class U extends F{constructor(){super(),this._fstch=null,this._lsib=null,this._rsib=null,this._parent=null,this._tree=this}$is_parent_of(t){return t.$parent()===this}$is_root_of(t){return t.$root()===this}$is_descendant_of(t){return t.$deses(!1).indexOf(this)>=0}$is_inclusive_descendant_of(t){return t.$deses(!0).indexOf(this)>=0}$is_ancestor_of(t){return t.$ances(!1).indexOf(this)>=0}$is_inclusive_ancestor_of(t){return t.$ances(!0).indexOf(this)>=0}$is_sibling_of(t){return t.$sibs(!1).indexOf(this)>=0}$is_inclusive_siblings_of(t){return t.$sibs(!0).indexOf(this)>=0}$is_preceding_of(t){let e=t.$sdfs(),n=e.indexOf(t),r=e.indexof(this);return r>=0&&r<n}$is_following_of(t){let e=t.$sdfs(),n=e.indexOf(t);return e.indexof(this)>n}$is_first_child_of(t){return this===t.$fstch()}$is_child_of(t){return t.$children().indexOf(this)>=0}$is_last_child_of(t){return this===t.$lstch()}$is_previous_sibling_of(t){return this===t.$lsib()}$is_next_sibling_of(t){return this===t.$rsib()}$index(){return this.$sibseq()}$sdfs_index(){return this.$sdfs().indexOf(this)}}function V(t){if("string"==typeof t){return G(r.rjson(t))}if("object"==typeof t){return G(t)}return new U}t.exports={Node:F,Tree:U,Root:U,load:V,load_from_nest_dict:function(t,e="_children"){return function(t,e="_children"){let n=D(t,e),r=[{d:t,nd:n}];for(;r.length>0;){let t=[];for(let n=0;n<r.length;n++){let i=r[n].d,l=r[n].nd,s=void 0===i[e]?[]:i[e];for(let n=0;n<s.length;n++){let r=s[n],i=D(r,e);l.$append_child(i);let u={d:r,nd:i};t.push(u)}}r=t}return n}(t,e)},clone:function(t){return t.$dump(),V(ndict)},struct_eq:function(t,e){let n=t.$sdfs2mat(),r=e.$sdfs2mat(),i=Array.prototype.concat(...n),l=Array.prototype.concat(...r);if(i.length!==l.length)return!1;for(let t=0;t<i.length;t++)if(s=i[t],u=l[t],s._pbreadth!==u._pbreadth||s._breadth!==u._breadth||s._depth!==u._depth)return!1;var s,u;return!0}}},function(t,e){t.exports={EventTarget:class{constructor(){}addEventListener(t,e,n={}){}removeEventListener(t,e,n={}){}dispatchEvent(t){}}}},function(t,e,n){const r=n(1),i=n(0),l={t:"├── ",v:"│   ",l:"└── ",ws:"    "},s={t:"├── ",v:"│   ",l:"┌── ",ws:"    "};function u(t){let e;return e="t"===t||"v"===t?"v":"ws",e}function o(t,e){return(t=t.map(t=>e[t])).join("")}function _(t){for(let e in t)delete t[e]._ui}function f(t,e){if(t._ui={},r.is_root(t))t._ui.conns=[],t._ui.display=!0;else{let n=r.get_parent(t,e)._ui.conns.map(t=>u(t));r.is_lstch(t)?n.push("l"):n.push("t"),t._ui.conns=n,t._ui.display=!0}return t}function c(t,e,n){let i=r.get_depth(t,e),s=r.get_deses(t,e,!0);s=s.map(t=>f(t,e));let u=s.map(t=>t._ui.conns);u=u.map(t=>t.slice(i)),u=u.map(t=>o(t,l));let _=u.map((t,e)=>t+"["+s[e]._id+"] : "+s[e]._guid);return _=_.filter((t,e)=>!0===s[e]._ui.display),_}function d(){}function h(){}function a(t,e){if(t._ui={},r.is_root(t))t._ui.conns=[];else{let n=r.get_parent(t,e)._ui.conns.map(t=>u(t));r.is_fstch(t)?n.push("l"):n.push("t"),t._ui.conns=n}return t}function p(t,e,n){let i=r.get_depth(t,e),l=r.get_edfs(t,e);l.reverse(),l=l.map(t=>a(t,e)),l.reverse();let u=r.get_deses(t,e,!0).map(t=>t._id);l=l.filter(t=>u.includes(t._id));let _=l.map(t=>t._ui.conns);return _=_.map(t=>t.slice(i,t.length)),_=_.map(t=>o(t,s)),_.map((t,e)=>t+l[e]._id)}const $={indent:"    ",stag_prefix:"<",stag_suffix:">",etag_prefix:"</",etag_suffix:">"};function g(t,e,n){return e+t+n}t.exports={dflt_calc_conn_map_func:u,conns2repr:o,clear_ui:_,dflt_sdfs_show_connd:l,dflt_sdfs_calc_conns:f,get_sdfs_repr_arr:c,sdfs_show_all:function(t,e,n=d){c(r.get_root(t,e),e);let i=c(t,e).join("\n");console.log(i),_(e)},sdfs_show_root_tree:function(t,e=d){let n=i.dict_keys(t)[0],l=c(r.get_root(t[n],t),t).join("\n");console.log(l),_(t)},sdfs_show_from:function(t,e,n,i=d){c(r.get_root(t,e),e);let l=c(t,e);l=l.slice(n);let s=l.join("\n");console.log(s),_(e)},sdfs_show_to:function(t,e,n,i=d){c(r.get_root(t,e),e);let l=c(t,e);l=l.slice(0,n);let s=l.join("\n");console.log(s),_(e)},sdfs_show_from_to:function(t,e,n,i,l=d){c(r.get_root(t,e),e);let s=c(t,e);s=s.slice(n,i);let u=s.join("\n");console.log(u),_(e)},sdfs_expand:function(t,e,n=d){return r.get_deses(t,e,!1).forEach(t=>{t._ui.display=!0}),e},sdfs_foldup:function(t,e,n=d){return r.get_deses(t,e,!1).forEach(t=>{t._ui.display=!1}),e},dflt_edfs_show_connd:s,dflt_edfs_calc_conns:a,get_edfs_repr_arr:p,edfs_show_all:function(t,e,n=h){p(r.get_root(t,e),e);let i=p(t,e).join("\n");console.log(i),_(e)},edfs_show_root_tree:function(t,e=h){let n=i.dict_keys(t)[0],l=p(r.get_root(t[n],t),t).join("\n");console.log(l),_(t)},edfs_show_from:function(t,e,n,i=h){r.get_root(t,e),p(t,e);let l=p(t,e);l=l.slice(0,l.length-n);let s=l.join("\n");console.log(s),_(e)},edfs_show_to:function(t,e,n,i=h){r.get_root(t,e),p(t,e);let l=p(t,e);l=l.slice(l.length-n,l.length);let s=l.join("\n");console.log(s),_(e)},edfs_show_from_to:function(t,e,n,i,l=h){r.get_root(t,e),p(t,e);let s=p(t,e);s=s.slice(s.length-i,s.length-n);let u=s.join("\n");console.log(u),_(e)},dflt_sedfs_show_connd:$,gen_tag:g,sedfs_show_all:function(t,e,n=$){let i=r.get_sedfs(t,e,!0),l=i.map(t=>r.get_depth(t,e)),s=r.get_depth(t,e),u=l.map(t=>n.indent.repeat(t-s)),o=i.map(t=>!1===t._$visited?g(t._id,n.stag_prefix,n.stag_suffix):g(t._id,n.etag_prefix,n.etag_suffix)).map((t,e)=>u[e]+t).join("\n");console.log(o)}}}])}));
//# sourceMappingURL=ndtree.js.map